
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>David Cramer's Blog</title>
    <meta name="author" content="David Cramer">

    
    <meta name="description" content="The EA Experience (EA Store) (My apologies this rant is long and should probably be called &#8220;The EA Nightmare&#8221;) As many of you are aware &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="http://feeds.feedburner.com/DavidCramernet" rel="alternate" title="David Cramer's Blog" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css?1" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4f0ffdc0844d521595000001');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
    

</head>

<body>
	<header class="inner"><h1><a href="/">David Cramer's Blog</a></h1>
<nav class="menu"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:justcramer.com">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/zeeg" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/dcramer" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="http://feeds.feedburner.com/DavidCramernet" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/2009/06/03/the-ea-experience">The EA Experience (EA Store)</a></h1>
    <div class="entry">
        <p>(My apologies this rant is long and should probably be called &#8220;The EA <strong>Nightmare</strong>&#8221;)</p>

<p>As many of you are aware, yesterday was the launch of one of the more anticipated games this year: <strong>The Sims 3</strong>. So, being a typical gamer, I had to pick it up (and the fact that my girlfriend is nuts about Sims 2). I decided that I would be best served, by going straight to the source. Typically I purchased digital downloads through Steam or Direct2Drive, but since EA has its own digital service it just made sense to purchase from ea.com. Oh boy, was that a bad decision.</p>

<p>To begin our story, lets take the setting back to about 3pm PST on June 2nd, launch day. I quickly pop into Steam to see that The Sims 3 is not available (not a surprise, really), so I head to ea.com to purchase it. I didn&#8217;t actually realize I would be unable to download the game for another 4 hours, but that wasn&#8217;t too much of a concern. I had no problems preordering the game, and EA had no problems charging me $50.</p>

<p>After digging around, I came to the realization that I would not even be able to start my download until 7PM PST. Ok, that&#8217;s a little weird, Steam let&#8217;s you download the game ahead of time and it will just activate when the game is available. A bit annoying, but again, not a huge deal. So, I get back to work, and time passes.</p>

<p>We&#8217;re now rolling up on 7PM, and I&#8217;m getting excited. It&#8217;s always amazing to see what they do with the new Sims games, and this one should be no different. The clock hits five after seven, and I am running around the EA.com store to find out how I download my pre-order. Nothing shows up in my download manager, so I assume that I must have to activate it in there somehow first. Fifteen minutes are wasted and I&#8217;m still unable to find a download link.</p>

<p>Then, being the typical crazy smart computer person that I am, I go to Google and type &#8220;WHERE THE HELL IS MY SIMS 3 DOWNLOAD&#8221;. Ok, so that didn&#8217;t turn out too wel, let&#8217;s try again: &#8220;how to downloads sims 3 preorder ea store&#8221;. I end up at a <a href="http://www.gamespot.com/pc/strategy/thesims3/show_msgs.php?topic_id=m-1-49776326&pid=936498">thread on GameSpot</a>. Well, that was no help. In fact, not a single result showed any problems. So I&#8217;m out of luck on that matter.</p>

<p>After a bit more searching, I find out that there should be an unlock code, and a download button. So I head to my view orders (which is difficult to find, really), and attempt to login. Wait, password invalid? How can my password be invalid I just logged in 5 minutes ago with the same time. So I try another 5 times to get my password to work. Nothing. I then proceed to reset my password, still confused, and it works.</p>

<p>Now I&#8217;m in my order, and I see the title for &#8220;Unlock Code&#8221; but it&#8217;s empty below it, and I see no download link. Oh, there&#8217;s a &#8220;View Invoice&#8221; button, that must be where I go to download it! But wait, an internal server error, grrr. I sit confused, and decide that maybe EA is another amazing company who&#8217;s site only works in IE. A quick browser swap confirms they at least can write proper CSS.</p>

<p>Being the persistent person that I am, I had yet another idea, to try it on Firefox on my Mac. I click through to Customer Support, and click View orders, time to login again. Invalid password, again!? It turns out there are a half dozen different login mechanisms on this site. One says my password is invalid, one logs me in, but redirects to a page which doesn&#8217;t load, and the other works, but I have no idea where it&#8217;s at. After another 15 minutes of hell, I manage to login and view my orders. Wooo, the page has an &#8220;Add extended download service&#8221; button.</p>

<p>I proceed to purchase extended download service in the hopes that this may correct their amazing ordering system. After letting EA nickel and dime me some more, I still end up with no download link. I decide to give it time, since it&#8217;s launch day and might just be a bit behind. I go back to work for another hour and an email pops up, &#8220;Order confirmation &#8230;.&#8221;. I&#8217;m thinking, &#8220;Yes! It really was just taking a bit of time&#8221;. I hop over to my inbox and it tells me all about how I&#8217;m supposed to download the game and where to find it.</p>

<p>So now that I&#8217;m assured there&#8217;s a way to download my game, I go through the 15 minute process of finding a way to login to the order history again. I finally manage to login, and my orders look exactly the same. Both charges have successfully been made on my PayPal account (paid through a CC, so there&#8217;s no delay), but I still see nothing new. I decide &#8220;hey, maybe EA just sucks, and the download link really does exist&#8221;. View Source quickly finds me a download header, but nothing in it, darn.</p>

<p>It is now the next day, and I&#8217;m getting extremely frustrated with my lack of Sims. I decide it will be much easier to just call them and take out my anger on the unlucky support worker. Easy enough, right? Of course not! It takes me another 30 minutes of digging around their site, and eventually using Google just to find a page which actually has a REAL phone number I can call. Someone picks up the phone after a 30 minute wait, yes 30 minutes on a number which is <strong>not</strong> toll free (so its long distance). I hear what almost sounds like an Arabic accent, but wait, it&#8217;s not your typical hard to understand technical support person, they just have such amazing Mics that it muffles everything in the background!</p>

<p>I proceed to give them my order number, and any other information they ask for. This takes me another 10 minutes or so. I&#8217;m getting excited simply due to the fact that it&#8217;s a real person, and they MUST have a solution for me. Well, that was another bad call. I&#8217;m told that &#8220;electronic orders take time to process&#8221;. Oh, do they? Maybe they did in 1980 before they were invented. I can wire enough money to fund development on The Sims 3 before they can process my $50 transaction.</p>

<p>So it is now 24 hours after the fact, I still have no Sims 3, and I will never purchase another product through EA again. I&#8217;m hoping that my rant of frustration will also convince others to do the same. I&#8217;ll stick with <a href="http://www.direct2drive.com">Direct2Drive</a> and <a href="http://www.steampowered.com">Steam</a> in the future.</p>

<p>Let&#8217;s throw in some Google love for EA here:</p>

<p>- <strong>Electronic Arts is terrible</strong><br>- <strong>Ordering online from Electronic Arts</strong><br>- <strong>EA Store</strong></p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-06-03T00:00:00-07:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/04/17/improving-gzipmiddleware-in-django">Improving GZipMiddleware in Django</a></h1>
    <div class="entry">
        <p>One issue we had come up over at iBegin lately, is the fact that GZipMiddleware tries to encode ALL responses (with a few minor exceptions). In our cases, we sometimes stream actual binary files over the response. Doing this with the standard middleware causes a unicode error as it&#8217;s trying to encode all of the information before gzipping it.</p>

<p>So to fix this, we simply created a slightly improved middleware to handle the content types a bit better:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.middleware.gzip</span> <span class="kn">import</span> <span class="n">GZipMiddleware</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">class</span> <span class="nc">ImprovedGZipMiddleware</span><span class="p">(</span><span class="n">GZipMiddleware</span><span class="p">):</span>
</span><span class='line'><span class="sd">&quot;&quot;&quot;Will GZip the content if it&#39;s not text/*, xml, or a javascript content type.&quot;&quot;&quot;</span>
</span><span class='line'><span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
</span><span class='line'><span class="n">ctype</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="n">ctype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;text/&#39;</span><span class="p">)</span>\
</span><span class='line'><span class="ow">or</span> <span class="s">&#39;javascript&#39;</span> <span class="ow">in</span> <span class="n">ctype</span>\
</span><span class='line'><span class="ow">or</span> <span class="s">&#39;xml&#39;</span> <span class="ow">in</span> <span class="n">ctype</span><span class="p">:</span>
</span><span class='line'><span class="k">return</span> <span class="n">response</span>
</span><span class='line'><span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedGZipMiddleware</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-04-17T00:00:00-07:00" pubdate data-updated="true">Apr 17<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/categories/django/'>django</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/04/14/cleaning-up-with-json-and-sql">Cleaning Up With JSON and SQL in Django</a></h1>
    <div class="entry">
        <p>Most of our projects lately are now using JSON data storage in the database. This makes it very efficient for storing additional data without having to run alters are gigantic data sets. It also allows us to store different data for different kinds of sets within the same table.</p>

<p>Doing this in Django we originally created a JSONField. A simple custom field which would convert back and from from JSON to a Python object. Mostly this was going from a dictionary to a text-based form in the database (JSON). Recently in one project I took the time to update the field to fix a couple things as well as add support for it in the forms, and thus making it usable within the admin.</p>

<p>So, for the wanting, here&#8217;s our updated JSONField and the related form field.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">simplejson</span> <span class="k">as</span> <span class="n">json</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JSONWidget</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">):</span>
</span><span class='line'><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
</span><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JSONFormField</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">):</span>
</span><span class='line'><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;widget&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONWidget</span>
</span><span class='line'><span class="nb">super</span><span class="p">(</span><span class="n">JSONFormField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span> <span class="k">return</span>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'><span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
</span><span class='line'><span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">u&#39;JSON decode error: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">exc</span><span class="p">),))</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JSONField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">):</span>
</span><span class='line'><span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SubfieldBase</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">formfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'><span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">formfield</span><span class="p">(</span><span class="n">form_class</span><span class="o">=</span><span class="n">JSONFormField</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
</span><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'><span class="k">return</span> <span class="n">value</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_db_prep_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'><span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
</span><span class='line'><span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">value_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
</span><span class='line'><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_from_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span class='line'><span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_db_prep_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-04-14T00:00:00-07:00" pubdate data-updated="true">Apr 14<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/categories/django/'>django</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/04/04/refactoring-lifestream">Refactoring Lifestream</a></h1>
    <div class="entry">
        <p>For a while now I&#8217;ve been wanting to rewrite Lifestream into a contained OO pattern. It seems to be the &#8220;best practice&#8221; when it comes to WordPress, but tutorials and what are not spread out so it took a bit of time.</p>

<p>During the process, I also took the opportunity to speed up certain areas, such as option calls. Instead of storing options on a per-key basis, I changed it over to simply use a serialized arrays. In such, I added several new commands to the codebase:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">function _populate_option_cache()</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    if (!$this-&gt;_optioncache)</span>
</span><span class='line'><span class="x">    {</span>
</span><span class='line'><span class="x">        $this-&gt;_optioncache = get_option(&#39;lifestream_options&#39;);</span>
</span><span class='line'><span class="x">        if (!$this-&gt;_optioncache) $this-&gt;_optioncache = $this-&gt;_options;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">/**</span>
</span><span class='line'><span class="x">* Fetches the value of an option. Returns `null` if the option is not set.</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">function get_option($option, $default=null)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    $this-&gt;_populate_option_cache();</span>
</span><span class='line'><span class="x">    $value = $this-&gt;_optioncache[$option];</span>
</span><span class='line'><span class="x">    if (!$value) {</span>
</span><span class='line'><span class="x">        return $default;</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'><span class="x">    return $value;</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">/**</span>
</span><span class='line'><span class="x">* Removes an option.</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">function delete_option($option)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    $this-&gt;_populate_option-cache();</span>
</span><span class='line'><span class="x">    unset($this-&gt;_optioncache[$option]);</span>
</span><span class='line'><span class="x">    update_option(&#39;lifestream_options&#39;, $this-&gt;_optioncache);</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">/**</span>
</span><span class='line'><span class="x">* Updates the value of an option.</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">function update_option($option, $value)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    $this-&gt;_populate_option_cache();</span>
</span><span class='line'><span class="x">    $this-&gt;_optioncache[$option] = $value;</span>
</span><span class='line'><span class="x">    update_option(&#39;lifestream_options&#39;, $this-&gt;_optioncache);</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">/**</span>
</span><span class='line'><span class="x">* Sets an option if it doesn&#39;t exist.</span>
</span><span class='line'><span class="x">*/</span>
</span><span class='line'><span class="x">function add_option($option, $value)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    $this-&gt;_populate_option_cache();</span>
</span><span class='line'><span class="x">    if (!array_key_exists($option, $this-&gt;_optioncache))</span>
</span><span class='line'><span class="x">    {</span>
</span><span class='line'><span class="x">        $this-&gt;_optioncache[$option] = $value;</span>
</span><span class='line'><span class="x">        add_option(&#39;lifestream_options&#39;, serialize($this-&gt;_optioncache));</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

From here I moved on to change all the translation calls <code>__</code>, and <code>_e</code> into using a built-in version of which automatically handles the sprintf calls, and the namespace.

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">function __($text, $params=null)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    if (!is_array($params))</span>
</span><span class='line'><span class="x">    {</span>
</span><span class='line'><span class="x">        $params = func_get_args();</span>
</span><span class='line'><span class="x">        $params = array_slice($params, 1);</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'><span class="x">    return vsprintf(__($text, &#39;lifestream&#39;), $params);</span>
</span><span class='line'><span class="x">}</span>
</span><span class='line'>
</span><span class='line'><span class="x">function _e($text, $params=null)</span>
</span><span class='line'><span class="x">{</span>
</span><span class='line'><span class="x">    if (!is_array($params))</span>
</span><span class='line'><span class="x">    {</span>
</span><span class='line'><span class="x">        $params = func_get_args();</span>
</span><span class='line'><span class="x">        $params = array_slice($params, 1);</span>
</span><span class='line'><span class="x">    }</span>
</span><span class='line'><span class="x">    echo vsprintf(__($text, &#39;lifestream&#39;), $params);</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>These two things alone cleaned up a LOT of the plugin, and the efficiency gain from the options change is amazing.</p>

<p>From there I decided to go all out, beyond just refactoring it into a class, I began adding some functionality from our upcoming service. Labels were moved out of the feed classes, and instead are now their own class. Each label is reusable, and controls how it&#8217;s events should be rendered. Doing this really opened the door to the possibilities of different styles of rendering for different media types.</p>

<p>So after a nice days work, I&#8217;ve pushed out <a href="http://wordpress.org/extend/plugins/lifestream/">wp-lifestream 0.96</a>, which contains an enormous amount of bug fixes, optimizations, and best of all new features. You can see it running live on my blog, with the new display styles and all. Hopefully tomorrow I will be able to finish up the permalinks for events, which will also give the ability to attach comments to them.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-04-04T00:00:00-07:00" pubdate data-updated="true">Apr 4<span>th</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/04/02/problems-uploading-packages-with-setuptools-on-os-x">Problems Uploading Packages With Setuptools on OS X</a></h1>
    <div class="entry">
        <p>This is mostly a note to myself, but also since my blog is very helpful to fellow Google-users I figured I&#8217;d throw it up here publicly.</p>

<p>Today I needed to update a package on PyPi using setuptools:</p>

<pre>python setup.py sdist register upload</pre>

<p>The problem was, no matter what I did, I always seemed to get this error:</p>

<pre><strong>Upload failed (401): You must be identified to edit package information</strong></pre>

<p>I also noticed that while it was asking me to save my login information, and I hit Y everytime, it still asked me for the username and password. It turned out that it was saving the information incorrectly as follows:</p>

<pre><br>[pypi]<br>username:dcramer<br>password:*******<br></pre>

<p>Changing it out to this solved the problems:</p>

<pre><br>[server-login]<br>username:dcramer<br>password:********<br></pre>

<p>Can&#8217;t quite explain it, but as I&#8217;m sure other people have come across this same issue, maybe it will get resolved in the near future.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-04-02T00:00:00-07:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/03/25/setting-up-django-and-sphinx-full-text-search-django-sphinx">Setting Up Django and Sphinx Full-text Search (Django-sphinx)</a></h1>
    <div class="entry">
        <p>A while back I posted a quick, and very simplistic guide to setting up django-sphinx within your project. Since that time we&#8217;ve gained a lot of use of the platform. It came to my attention today that the <a href="http://groups.google.com/group/django-nyc">django-nyc</a> group was going to do a presentation on how to setup sphinx within your Django project. This, and many, many questions later, I&#8217;ve decided to rewrite my guide to setting up Sphinx with your project.<br>
        
        <a href="/2009/03/25/setting-up-django-and-sphinx-full-text-search-django-sphinx" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-03-25T00:00:00-07:00" pubdate data-updated="true">Mar 25<span>th</span>, 2009</time></div>
        <div class="tags">

<div class="cat">
  
    <a class='category' href='/categories/django/'>django</a>
  
</div>

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/03/14/scaling-your-frontend-far-futures-headers-and-template-tags">Scaling Your Frontend: Far-Futures Headers and Template Tags</a></h1>
    <div class="entry">
        <p>One of the many things we do to help optimize our website load times is optimize the frontend by setting far-futures headers. This simply means that media has an Expires tag of sometime in the distant future (maybe a year), and when we make changes, the filename needs to change. The easiest way to do this, is by adding a simple GET parameter.</p>

<p>To handle this, we had been using a simple revision system, where we just increment a number in a list of files, and it appends that number to the filename. After realizing how lazy we should have been, I quickly rewrote it to grab the file modification time and use that as the revision number.</p>

<p>Anyways, we did this by using a simple template tag (or a global object as it&#8217;s known in Jinja), to output the URL to the file, as well as the revision.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">jinja.contrib.djangosupport</span> <span class="kn">import</span> <span class="n">register</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">def</span> <span class="nf">mediaurl</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span class='line'><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</span><span class='line'><span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">BASE_PATH</span><span class="p">):</span>
</span><span class='line'><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Media must be located within MEDIA_ROOT.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">?</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)))</span>
</span><span class='line'><span class="n">register</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">mediaurl</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

Now to link our media files it&#8217;s quick and painless:

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- iBegin Stylesheets --&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;print&quot;</span> <span class="na">href=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="c">&lt;!-- JavaScript --&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span><span class="nx">BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span><span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-03-14T00:00:00-07:00" pubdate data-updated="true">Mar 14<span>th</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/03/12/mac-os-x-security-update-2009-01-perl-fix">Mac OS X Security Update 2009-01 Fix for Perl and Fink</a></h1>
    <div class="entry">
        <p>As many users like myself probably have noticed, Apple seriously fucked us with their latest security release. From what I&#8217;ve read, they reverted Perl to an older version which doesn&#8217;t support some common features.</p>

<p>I began receiving errors such as the following with fink and other applications:</p>

<ul><li><strong>IO object version 1.22 does not match bootstrap parameter 1.23</strong></li><li>Storable object version 2.15 does not match $Storable::VERSION 2.18</li><li>DB_File object version 1.814 does not match bootstrap parameter 1.817</li></ul>

<p>After a bit of searching, and trying some various things, I&#8217;ve come up with the following solution (which may be specific to my problems):</p>

<pre><br>mkdir -p /fixforperl<br>cd !$<br>curl -O http://search.cpan.org/CPAN/authors/id/G/GB/GBARR/IO-1.2301.tar.gz<br>curl -O http://search.cpan.org/CPAN/authors/id/P/PM/PMQS/DB_File-1.819.tar.gz<br>curl -O http://search.cpan.org/CPAN/authors/id/A/AM/AMS/Storable-2.18.tar.gz<br>tar xzf IO-1.2301.tar.gz<br>tar xzf DB_File-1.819.tar.gz<br>tar xzf Storable-2.18.tar.gz<br>cd IO-1.2301 && perl Makefile.PL && make && sudo make install && cd ..<br>cd DB_File-1.819 && perl Makefile.PL && make && sudo make install && cd ..<br>cd Storable-2.18 && perl Makefile.PL && make && sudo make install && cd ..<br></pre>

<p>There may be other libraries which you need to update as well. These are just the ones I&#8217;ve encountered so far. The process is the same for each library. Simply grab the package off of CPAN, run the Makefile.PL, and make install.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-03-12T00:00:00-07:00" pubdate data-updated="true">Mar 12<span>th</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/02/28/improved-uuidfield-in-django">Improved UUIDField in Django</a></h1>
    <div class="entry">
        <p>So today I went ahead and cleaned up my UUIDField implementation. Originally it was just based off of a snippet. I wanted to swap it over to use a BINARY column in MySQL, after reading on how <a href="http://bret.appspot.com/entry/how-friendfeed-uses-mysql">FriendFeed had been using UUIDs</a>. Due to using Django however, you can&#8217;t use binary data or BLOB columns effectively. It tries to coerce everything to unicode so it ends up failing on any kind of binary data.</p>

<p>Instead of using a BINARY(16) column, I just switched over to a CHAR(32) (previously a CHAR(36)). In doing this I also converted the field to keep everything in the UUID format (to better handle passing around the values, and converting to any format you want).</p>

<p>All in all, the new UUIDField works as intended, and is a nice improvement over the simple &#8220;automatically insert a UUID here&#8221;, which is what it was before.</p>

<p>Grab the code on <a href="https://github.com/dcramer/django-uuidfield">GitHub</a></p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-02-28T00:00:00-08:00" pubdate data-updated="true">Feb 28<span>th</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2009/02/22/javascript-widgets-on-nibbits">JavaScript Widgets on Nibbits</a></h1>
    <div class="entry">
        <p>Quite a while back I introduced basic JavaScript widgets on Nibbits. These let site owners embed a simple box on their own site which shows basic information, as well as a download link for their maps.</p>

<p>So, why am I posting about this? Simply to spread the word, and to demo it of course :)</p>

<p><script src="http://www.nibbits.com/wc3/maps/view/125228/widget.js"></script></p>

<p><script src="http://www.nibbits.com/sc/maps/view/125214/widget.js"></script></p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2009-02-22T00:00:00-08:00" pubdate data-updated="true">Feb 22<span>nd</span>, 2009</time></div>
        <div class="tags">

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
        <a href="/blog/page/6/" class="next">Next</a>
    
    <a href="/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012 David Cramer &mdash; Need exceptional error logging? Try out <a href="https://www.getsentry.com">Sentry</a></footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'davidcramer';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>