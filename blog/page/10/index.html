
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>David Cramer's Blog</title>
    <meta name="author" content="David Cramer">

    
    <meta name="description" content="iBegin Share Update We released new versions of iBegin Share and the Wordpress plug-in this morning. These are critical updates to solve display &hellip;">
    
    <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

    <link href="http://feeds.feedburner.com/DavidCramernet" rel="alternate" title="David Cramer's Blog" type="application/atom+xml">
    <link rel="canonical" href="">
    <link href="/favicon.png" rel="shortcut icon">
    <link href="/stylesheets/screen.css?1" media="screen, projection" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4f0ffdc0844d521595000001');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
    

</head>

<body>
	<header class="inner"><h1><a href="/">David Cramer's Blog</a></h1>
<nav class="menu"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<div class="right">
	<form class="search right" action="http://google.com/search" method="get">
		<input class="left" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:justcramer.com">
	</form>
	<div class="social right">
		
		
		
		<a class="twitter" href="http://twitter.com/zeeg" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/dcramer" title="GitHub">GitHub</a>
		
		
		
		<a class="rss" href="http://feeds.feedburner.com/DavidCramernet" title="RSS">RSS</a>
		
	</div>
</div>

</header>
	<div id="content" class="inner">


    <article class="post">
    <h1 class="title"><a href="/2008/04/04/ibegin-share-update">iBegin Share Update</a></h1>
    <div class="entry">
        <p>We released new versions of iBegin Share and the Wordpress plug-in this morning. These are critical updates to solve display inconsistencies across browsers. You can grab them both over at <a href="http://labs.ibegin.com/">the labs</a>.</p>

<p>If you don&#8217;t know what iBegin Share is, it&#8217;s a simple tool which allows you to &#8220;share&#8221; pages of your website. It&#8217;s very similar to things like ShareThis, except that it adds even more depth to the situation. You can view a demo of it by clicking &#8220;Share&#8221; below the title of this post.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-04-04T00:00:00-07:00" pubdate data-updated="true">Apr 4<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/04/04/announcing-django-sphinx-200">Announcing Django-sphinx 2.0.0 Full-text Search</a></h1>
    <div class="entry">
        <p>One of my tasks lately has been updating the <a href="http://code.google.com/p/django-sphinx">django-sphinx</a> library to work with Sphinx 0.98, as it includes GIS components which we have been wanting to possibly utilize on our new search engine. So today, the conclusion of.. very few hours of work, I&#8217;d like to announce 2.0.0 of the Django integration.</p>

<p>The SphinxSearch manager has been completely rewritten to rely strictly on the Python Sphinx API (a request from the author of Sphinx), which means it should have much more compatibility with newer versions in the future. I have also updated the querysets it returns to work like normal Django QuerySet instances, to where they clone themselves so you can fork your queryset into several different actions.</p>

<p>The search results also now have a proxy which wraps each object. This proxy is specifically geared towards <a href="http://code.djangoproject.com/ticket/17">ticket #17</a>, and allows you to access a <code>_sphinx</code> attribute on each instance, without actually modifying that instance. You can also now access a <code>_sphinx</code> attribute on the queryset itself. Both of these contain relative meta-data for their object.</p>

<p>So, a quick usage example using the new API:<br><pre><br>In [1]: from sphinxtest.tests.models import *</p>

<p>In [2]: x = Document.search.query('a')</p>

<p>In [3]: x._sphinx<br>Out[3]:<br>{'total': 10,<br>'total_found': 10,<br>'words': [{'docs': 10, 'hits': 10, 'word': 'a'}]}</p>

<p>In [4]: x<br>Out[4]: [&lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;, &lt;Document: Document object&gt;]</p>

<p>In [5]: x[0]._sphinx<br>Out[5]: {'weight': 1}</p>

<p>In [6]: x[0].title<br>Out[6]: u'Document 0'</p>

<p>In [7]: type(x)<br>Out[7]: &lt;class 'djangosphinx.SphinxSearch'&gt;</p>

<p>In [8]: type(x[0])<br>Out[8]: &lt;class 'djangosphinx.SphinxProxy'&gt;<br></pre></p>

<p>As you can see, it&#8217;s full backwards compatible. Calling <code>queryset._sphinx</code> will force evaluation on the queryset. Grab the release over at <a href="http://code.google.com/p/django-sphinx">Google code</a>.</p>

<p>Comments and criticism, send em my way :)</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-04-04T00:00:00-07:00" pubdate data-updated="true">Apr 4<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/04/02/segmentation-fault">Segmentation Fault</a></h1>
    <div class="entry">
        <p>Last week I made the decision to begin the conversion from MySQL to PostgreSQL. Well, more of a benchmark conversion, but none the less. So we begin the installation..</p>

<p>I installed PostgreSQL server, version 8.2, painlessly both locally and on our staging server. I then installed psycopg2 via Python setuptools. Nice, quick and easy, right? <strong>Segmentation Fault</strong> when I try to sync up the database. So I figure maybe setuptools is outdated, and I removed psycopg2 and grabbed it with Darwin Ports. &#8220;Warning: [&#8230;]&#8221; everytime its initialized. I finally managed to get it working by downloading the source and compiling it. About an hour later, the only thing left to do is import the data&#8230;</p>

<p>First I needed to sync the database, <code>manage.py syncdb</code>. Yep, Django makes it quick and easy. Things worked fine, no problems yet.  I began importing the www.ibegin.com database (12 million business listings, among other meta data). About 10% through California (which is massive) I get &#8220;Cannot Adapt&#8221;. First thing that comes through my head is &#8220;What the fuck kind of error message is that?&#8221;. I come from a strictly MySQL background, and I stand behind it to this day. After a little bit of searching, and pestering #postgresql on freenode, I learned that <em>somehow</em> the primary key sequence had corrupted itself.</p>

<p>Correcting the sequence was fairly easy. You select the max value currently, and then do <code>setval()</code> or <code>nextval()</code> respectively on the sequence to fix it. I had no idea why this had occurred however.  I get done about 70% of the way through California, and notice my importer is slowing down. Oh, that&#8217;s right, my version of Django is still horrendously slow because it&#8217;s missing <a href="http://code.djangoproject.com/ticket/17">#17</a>.</p>

<p>I quickly optimize my script to store everything in memory, and turn off <code>settings.DEBUG</code> because it wastes too damn much memory. I then continue the import from where it left off, and I notice that every so often it hangs. I check my indexes, and my select queries, and they&#8217;re all blazing fast. After a bit more pestering of the #postgresql people, I learned that PGSQL <strong>sucks hardcore</strong> on count queries. Now I didn&#8217;t plan to use them like I was in the importer, but that&#8217;s still a pretty big setback. So, the 1,000,000 extra meta rows that would exist, will have to wait until the import is fully finished.</p>

<p>I get done with California, and move on to Florida, another fairly large state. I screen it and go to bed. I wake up to <strong>Cannot Adapt</strong> Again, &#8220;What the fuck!?&#8221;. This was getting very tiresome, and still is. I&#8217;m still only about 50% done with the import and I&#8217;ve had this come up at least a half dozen times already.</p>

<p>All in all, PostgreSQL is neat. Transactions are great. Row-locking is great. MySQL&#8217;s InnoDB isn&#8217;t. It has a GIS framework. It causes a lot of headaches. Weighing the pros vs the cons, we&#8217;re going to stick with it. We&#8217;ll be deploying the new iBegin.com page (powered by Django) running a PostgreSQl 8.3 database, which will be pretty massive, to which I&#8217;m hoping that I don&#8217;t have to patch Django for ticket #17 to handle it.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-04-02T00:00:00-07:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/04/01/dont-use-padding-or-margin-on-body-tags">Don&#8217;t Use Padding or Margin on BODY Tags</a></h1>
    <div class="entry">
        <p>Today I was adding full screen support to <a href="http://labs.ibegin.com/ibox">iBox</a>, and I hit an IE6 bug. The bug is introduced because the <code>BODY</code> tag had either <code>margin</code> or <code>padding</code> values of more than 0. This is a number of problems we&#8217;ve had with calculating positions because of the <code>BODY</code> clauses containing these extra pixels.</p>

<p>The solution:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="ni">&amp;lt;</span>style type=&quot;text/css&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>/* Remove the default margin and padding. */
</span><span class='line'>body { padding: 0; margin: 0; }
</span><span class='line'>
</span><span class='line'>/* Put your padding/margin on the wrapper clause. */
</span><span class='line'><span class="ni">&amp;lt;</span>/style<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>body<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>div id=&quot;wrapper&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/div<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/body<span class="ni">&amp;gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>The reasoning behind this, is that most JS objects which need to go outside of the page frame, are appending to BODY. When they&#8217;re appending they can position themselves wherever they need to be. However, if it needs to be say, 100% height, it&#8217;s a <acronym title="Pain in the Ass">PITA</acronym> to calculate that 100% if there&#8217;s margin or padding on an enclosing tag.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-04-01T00:00:00-07:00" pubdate data-updated="true">Apr 1<span>st</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/29/using-jinja-with-django">Using Jinja With Django</a></h1>
    <div class="entry">
        <p>Every time I meet someone new who asks me about Django, I tell them exactly what I think. It&#8217;s a great product. It does exactly what it&#8217;s designed to do. Allows you to build decently structured applications rapidly, without much overhead in doing so. One of the other things I tell them, is that the first they should do is scrap the template engine, and install Jinja.<br>
        
        <a href="/2008/03/29/using-jinja-with-django" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-29T00:00:00-07:00" pubdate data-updated="true">Mar 29<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/27/making-django-newforms-useful">Making Django Newforms Useful</a></h1>
    <div class="entry">
        <p>One of my goals, beyond the constant improvement of the ORM in Django, is to make django.newforms easier for all of the lazy people, like myself, which I know are plentiful. I personally hate the repetitive task of creating templates for your forms, and the as_X methods are extremely limited. So let&#8217;s get down to business.<br>
        
        <a href="/2008/03/27/making-django-newforms-useful" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-27T00:00:00-07:00" pubdate data-updated="true">Mar 27<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/24/modelchoicefields-as-charfields-in-django">ModelChoiceFields as CharFields in Django</a></h1>
    <div class="entry">
        <p>Today I was creating the submission form for the new iBegin.com homepage. In this we use a lot of JavaScript to make the process more clean. One such use, was an autocomplete on Cities and Categories. To do this, and to keep validation, you need to use a ModelChoiceField, but using a ModelChoiceField with a TextInput doesn&#8217;t work. So, I give you an <a href="http://www.pastethat.com/django-inlinemodelchoice">InlineModelChoiceField in Django</a>.</p>
<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">newforms</span> <span class="k">as</span> <span class="n">forms</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">InlineModelChoiceField</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;widget&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;widget&#39;</span><span class="p">,</span> <span class="n">forms</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">TextInput</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">InlineModelChoiceField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">required</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">None</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span class='line'>        <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span class='line'>            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">&quot;Please enter a valid </span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queryset</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,))</span>
</span></code></pre></td></tr></table></div></figure>

        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-24T00:00:00-07:00" pubdate data-updated="true">Mar 24<span>th</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/22/setup-mod_wsgi-for-django-and-shared-hosting">Setup Mod_wsgi for Django and Shared Hosting</a></h1>
    <div class="entry">
        <p>Recently I took the opportunity to configure my server for per-user hosting (to offer some free hosting to people who needed it). Doing this I had to configure mod_wsgi per-user as well. First, let me say that <a href="http://code.google.com/p/modwsgi/wiki/ConfigurationGuidelines">the documentation</a> is excellent, but real world examples are always very helpful. Below is the output of a script which runs per-user on my server.<br>
        
        <a href="/2008/03/22/setup-mod_wsgi-for-django-and-shared-hosting" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-22T00:00:00-07:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/22/deploying-django">How to Deploy Django With Subversion and Mod_wsgi</a></h1>
    <div class="entry">
        <p>Today a question was raised on how to deploy Django on your server. I figured it&#8217;d be useful to put together a quick how-to for deploying Django on your standard LAMP infrastructure. I&#8217;m not going to say the way we&#8217;ve done things is the best, or if it&#8217;s even common, but it&#8217;s the way we&#8217;ve handled it.<br>
        
        <a href="/2008/03/22/deploying-django" class="more-link">Read on &rarr;</a>
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-22T00:00:00-07:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>


    <article class="post">
    <h1 class="title"><a href="/2008/03/21/pastethat-ideas">PasteThat Ideas</a></h1>
    <div class="entry">
        <p>In response to a few suggestions from users, I had been thinking of ways to improve <a href="http://www.pastethat.com/">PasteThat</a>. While I feel it&#8217;s a superb engine for what it does, I think it can be expanded.</p>

<p>I&#8217;ve considered adding authentication and library features. What this would do is allow users who want long-term data available to sign-up and submit those pastes. They would then be able to &#8220;share&#8221; galleries. You&#8217;d simply tag a paste with any number of tags, and select that it is public.</p>

<p>These galleries could then be syndicated, to a different page or PasteThat, or I considered using one of my domains (such as Nibbits). That page could then allow users possibly rate and comment on the code, images, or URLs (seems strange). It would include a simple bookmarking system as well.</p>

<p>The core idea behind it, would be exactly the same as PasteThat currently is, except that it would be much easier to publicly share code (that is more than just a temporary paste), as I do quite often via my blog.</p>
        
        
    </div>
    <div class="meta">
        <div class="date">








  


<time datetime="2008-03-21T00:00:00-07:00" pubdate data-updated="true">Mar 21<span>st</span>, 2008</time></div>
        <div class="tags">

</div>
        
    </div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/9/" class="prev">Prev</a>
    
    
        <a href="/blog/page/11/" class="next">Next</a>
    
    <a href="/blog/archives" class="center">Blog Archives</a>
</nav></div>
	<footer class="inner">Copyright &copy; 2012 David Cramer &mdash; Need exceptional error logging? Try out <a href="https://www.getsentry.com">Sentry</a></footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script src="/javascripts/slash.js"></script>


<script type="text/javascript">
      var disqus_shortname = 'davidcramer';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>
</html>