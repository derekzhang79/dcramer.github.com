
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>David Cramer's Blog</title>
  <meta name="author" content="David Cramer">

  
  <meta name="description" content="Recently I&#8217;ve had to develop forum software for a website, and one problem we ran into was the most robust way to track unread posts. After &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dcramer.github.com/blog/page/15">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/DavidCramernet" rel="alternate" title="David Cramer's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">David Cramer's Blog</a></h1>
  
    <h2>Python at Scale.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/DavidCramernet" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dcramer.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives/">Archives</a></li>
  <li><a href="/resume/">Resume</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/10/22/tracking-unread-objects">Tracking Unread Objects</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-10-22T00:00:00-07:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I&#8217;ve had to develop forum software for a website, and one problem we ran into was the most robust way to track unread posts.</p>

<p>After giving this some thought, I came up with two feasable options. We&#8217;ll start by taking a look at the first.</p>

<p><strong>Pure Post Tracking</strong></p>

<p>Method one is to create a table:<br><blockquote>&#8220;forum_views&#8221;<br>postID (IntegerField)<br>userID (IntegerField)<br>Index (postID, userID)</blockquote><br>Everytime a user would view a post (that was marked as unread) we would insert a row into the table. To output the list of posts, or threads, we would be join the thread with this table.</p>

<p>Cons:<br><ul><br><li>In order to show the list of threads, or forums, you have to use a LEFT JOIN with the Thread and Views table (even on the forum index) which can be extremely slow on high load websites.</li><br><li>A different queryset is used for each user, so there&#8217;s no worthwhile caching for this method.</li><br><li>Upon viewing a thread you have to perform a query for each post that is marked as unread.</li><br></ul><br>Pros:<br><ul><br><li>It gives exact tracking on if a user has viewed a post.</li><br></ul><br>Obviously, the pros do NOT outweigh the cons, so let&#8217;s move on to the other method:</p>

<p><strong>Session Time Tracking</strong></p>

<p>The idea of this is simple, and extremely quick. Our first step is to modify our User table if it&#8217;s not already setup properly. We need to add one field:<br><blockquote>&#8220;users&#8221;<br>lastVisitTime (DateTimeField)</blockquote><br>Ok now we have a field in our users table, which tracks the last time they visited the website. Now, obviously, the first obstacle is keeping the last visit time, as the time they last visisted the site, and not the last time they viewed a page. The way we will do this is quite simple:<br><ol><br><li>First and foremost, we validate their login details, if they&#8217;re not anonymous.</li><br><li>Next we check for a session variable, let&#8217;s call it &#8220;user_lastvisit&#8221;.</li><br><li>If this variable does not exist, we will set it to the data in our table for lastVisitTime, or -1 (if they&#8217;re anonymous, or have no lastVisitTime)</li><br><li>If they are not anonymous, we now need to update our User table lastVisitTime with the current time.</li><br></ol><br>Now, as you can see, we have the session variable, user_lastvisit, and we can use this in our template, or view, in a loop over all of the <strong>cached</strong> query results, to see if the last reply time is greater than the last visit time.</p>

<p>Cons:<br><ul><br><li>It&#8217;s generic tracking; the minute the session is destroyed it marks all threads as read.</li><br><li>It does not track on a per-thread basis, although it could be combined with example #1 to do so.</li><br></ul><br>Pros:<br><ul><br><li>Extremely robust and quick, works well with caching solutions.</li><br><li>No large database overhead for tracking views.</li><br><li>No added database load for marking threads as read.</li><br></ul><br>If you want accurate tracking, I would recommend tracking views as said in example #1, with the views table, and then using example #2 for tracking on lists. The accurate tracking is most notably usable in search results.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/09/19/avast-me-hearties">Avast, Me Hearties!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-09-19T00:00:00-07:00" pubdate data-updated="true">Sep 19<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today be International Talk like a Sea dog Tide. Sea dogs an&#8217; land lubbers&#8217;s encouraged t&#8217; spice up the&#8217;r vocabulary today wi&#8217; a wee trusty gentleman o&#8217; fortune phrases an&#8217; kick aft on th&#8217; beach wi&#8217; a keg o&#8217; rum.</p>

<p>Be havin&#8217; fun!</p>

<p>Play World o&#8217; Warcraft? Ye may want t&#8217; check ou&#8217; this addon by Blaquen: <a href="http://www.curse-gaming.com/en/wow/addons-4504-1-piratespeak.html">Pirate Speak</a></p>

<p><a href="ftp://ftp.nibbits.com/PirateSong.mp3"><strong>Th&#8217; Official Tune</strong></a></p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/08/06/integrating-mediawiki-with-vanilla-forums">Integrating MediaWiki With Vanilla Forums</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-06T00:00:00-07:00" pubdate data-updated="true">Aug 6<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I undertook the challenge, or rather the lack-of, of <a href="http://lussumo.com/addons/index.php?PostBackAction=AddOn&AddOnID=130">integrating the MediaWiki userbase with Vanilla&#8217;s forum software</a>. This provides the nice ability to run MediaWiki and Vanilla forums without having two distinct authentication systems. It&#8217;s also a nice way of making people apply for access to edit the Wiki :)</p>

<p>Because Wordpress is horrible with this kind of stuff, I&#8217;ve moved it to <a href="http://lussumo.com/addons/index.php?PostBackAction=AddOn&AddOnID=130">Lussumo&#8217;s extension&#8217;s page</a>.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/08/01/sql-optimization-with-disk-caching-in-php">SQL Optimization With Disk Caching in PHP</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-08-01T00:00:00-07:00" pubdate data-updated="true">Aug 1<span>st</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One big thing with large sites is optimization, and a major factor in most sites is SQL. In the end, all optimization methods begin, and most likely end, with a caching solution. While disk caching is not the only solution, in my opinion, for most situations, it is the best solution.</p>

<p>With Nibbits I was in need of such a solution. Nibbits itself is extremely optimized in the code and the SQL queries, but even the most optimized code still can only handle so much load. So today, with about 30 minutes of spare time, I whipped up a quick standard disk caching library.</p>

<p>As always, you can grab the source for my <a href="/projects/diskCache.phps">PHP disk caching class.</a></p>

<p>The class follows the standard calls you see in nearly every major caching system, get and set.<br><blockquote><code>$c = new cache();<br>if (!$data = $c->get('group', 'unique id'))<br>{<br>$data = 'this was cached at '.date();<br>$c->set('group', 'unique id', 10, $data);<br>}</code></blockquote><br>There are two constants the source uses and you will most likely want to set:<br><blockquote><code>CACHE_DIRECTORY - the absolute path to the directory where cached data should reside<br>CACHE_PREFIX - the prefix the class should use on files in this directory</code></blockquote></p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/31/nibbits-update">Nibbits Update</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-31T00:00:00-07:00" pubdate data-updated="true">Jul 31<span>st</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I took some time Sunday to go over Nibbits and add the flexibility it&#8217;s been needing. In doing this I added two new sections. One for <a href="http://abandonware.nibbits.com/">Abandonware Games</a>, and another for <a href="http://roms.nibbits.com/">Roms and Emulators</a>.</p>

<p>I think I&#8217;m finally closing in on a pretty solid framework for the CMS and will soon be accepting a couple sites to test run the software. The current TODO list includes:<br><ul><br><li>Internationalization</li><br><li>Templates</li><br><li>Advanced search functions</li><br><li>Caching</li><br><li>Reimplementing tag views</li><br></ul><br>For those interested, the latest changes were focused on SE flexibility for page names, such as &#8220;World of Warcraft Files&#8221; differing from &#8220;Roms and Emulators&#8221; as it has no section name appended to it. This fix was made by adding a field to both the site and the section, which lets you either use a sprintf formatted string, or simply overwrite it with a title.</p>

<p>The second major change was removing the globalization on sections. The way it&#8217;s setup now is sections are generalized, but you set which sites hold which sections, and it also tracks when they were added. Two options were added to the configuration for adjusting how long to expire &#8220;new&#8221; items. One for sections, and one for site.</p>

<p>If you&#8217;re interested in the Nibbits framework, please let me know dcramer@gmail.com and I will give you more information. I will be doing limited testing with it on external sites and will then begin licensing the software.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/23/redirect-non-www-requests-to-www">Redirect Non-WWW Requests to WWW</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-23T00:00:00-07:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since everything on page one of google isn&#8217;t, well, perfect, here&#8217;s a fully working example where you don&#8217;t need to type in your silly domain name.</p>

<pre><br># redirect all non-www traffic<br>RewriteCond %{HTTP_HOST} ^([a-zA-Z0-9\-]*)\.com$<br>RewriteRule ^.*$ http://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]<br></pre>

<p>For the unknowing, this code uses <a href="http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html">mod_rewrite</a>.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/11/zidanes-headbutt">Zidane&#8217;s Headbutt</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-11T00:00:00-07:00" pubdate data-updated="true">Jul 11<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To be honest, I&#8217;m not a big football (soccer) fan, but the World Cup is always exciting. This year, I think it may have been even more so. With 10 minutes left in the game, the French team member Zinedine Zidane, decided he had enough. Why? Who knows, but he sure made sure an Italian player, <span class="txt3Bold">Materazzi</span><span class="txt4Bold">, by smashing his head into the Italian player&#8217;s chest.</span></p>

<p>To see it in action, check out my latest site, <a href="http://www.ggzidane.com/">Good Game Zidane</a>. The site was live 10 minutes after the event, gotta love GoDaddy and my servers :)<br><span class="txt4Bold" /></p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/06/vanilla-_the_-forum-software">Vanilla</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-06T00:00:00-07:00" pubdate data-updated="true">Jul 6<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Tired of using that piece of crap phpBB board, or maybe you&#8217;d just rather a cheaper and more user-friendly solution to vBulletin. Well, I&#8217;m happy to give my vote to a very well done project called Vanilla. Lussumo, the developers behind Vanilla, have just launched <a href="http://www.getvanilla.com/">Vanilla 1.0</a>, the first official release for the forum software.<br><blockquote>Vanilla is an open-source, standards-compliant, multi-lingual,             fully extensible discussion forum for the web. Anyone who has             web-space that meets the <a href="#ServerRequirements">requirements</a>             can download and use Vanilla for free!</blockquote><br>If you want to see it in action, you can check out their <a href="http://lussumo.com/community/">community site</a> or head over to the <a href="http://forums.hackwow.com/">forums at HackWOW</a> where we put it to use as well.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/07/06/signal-home">Signal Home</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-07-06T00:00:00-07:00" pubdate data-updated="true">Jul 6<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Wanted to give a shout out to anyone who&#8217;s into the rock/punk music scene. I just found out about this band yesterday but I like their stuff. Check out <a href="http://www.myspace.com/signalhome">Signal Home&#8217;s MySpace page</a> for a taste.</p>

<p>Also don&#8217;t miss <a href="http://www.myspace.com/hellogoodbye">Hellogoodbye&#8217;s upcoming album</a> release, it&#8217;s a good one!</p>

<p>One more band worth a mention, <a href="  http://www.myspace.com/goodbyevalentine  ">Goodbye Valentine</a> is a new oneÂ  on my list but they&#8217;re pretty good as well.</p></div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2006/06/29/wdb-to-csv-converter">WDB to CSV Converter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-06-29T00:00:00-07:00" pubdate data-updated="true">Jun 29<span>th</span>, 2006</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Jb55 has finished his <a href="http://www.jb55.com/9/wdb-to-csv-converter-released/">WDB to CSV conversion tool</a>, a must-have for anyone who deals w/ these on a normal basis. Make sure you also check out our resource site, <a href="http://www.hackwow.com/">HackWOW</a> for more information on WDB&#8217;s and the other files inside World of Warcraft.</p></div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/16/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/14/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/04/24/sticking-with-standards">Sticking With Standards</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/08/using-arrays-as-materialized-paths-in-postgres">Using Arrays as Materialized Paths in Postgres</a>
      </li>
    
      <li class="post">
        <a href="/2011/11/10/scaling-schema-changes">Scaling Schema Changes</a>
      </li>
    
      <li class="post">
        <a href="/2011/08/05/extending-django-nose">Integrating Django with Nose at DISQUS</a>
      </li>
    
      <li class="post">
        <a href="/2011/07/20/python-and-os-x-lion">Python and OS X Lion</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dcramer">@dcramer</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dcramer',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("zeeg", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/zeeg" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @zeeg</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - David Cramer -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'davidcramer';
      
        
        // var disqus_developer = 1;
        
            var disqus_identifier = ''
        
        var disqus_url = 'http://dcramer.github.com/blog/page/15/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4f0ffdc0844d521595000001');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>

</body>
</html>
